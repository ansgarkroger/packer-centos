# Kickstart file automatically generated by anaconda.

#version=DEVEL
install
cdrom

#make this a text install (we could comment this if we want to see what is happening)
text
lang en_US.UTF-8
keyboard us
network --onboot yes --device eth0 --bootproto dhcp --noipv6
rootpw --plaintext vagrant
firewall --service=ssh
authconfig --enableshadow --passalgo=sha512
selinux --permissive
timezone --utc Europe/Brussels
bootloader --location=mbr --driveorder=sda --append="crashkernel=auto rhgb quiet"

# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work

# Clean out the old disk config
zerombr

# Clean out old partitions
clearpart --all --drives=sda

# Make a new partition for the volgroup
part pv.008002 --size=19456 --ondisk=sda

# Make the volgroup
volgroup VolGroup --pesize=4096 pv.008002

# Make / on the volgroup
logvol / --fstype=ext4 --name=lv_root --vgname=VolGroup --grow --size=1024 --maxsize=19000

# Setup swap on the volgroup
logvol swap --name=lv_swap --vgname=VolGroup --grow --size=2016 --maxsize=2016

# Setup the boot partition on the volgroup
part /boot --fstype=ext4 --size=500

# Location of the package data

# apparently to be commented out as Anaconda already has a valid repo for CENTOS
# http://velenux.wordpress.com/2013/11/27/cannot-find-a-valid-baseurl-for-repo-centos/
# if this fails we migh look at https://projects.centos.org/trac/livecd/wiki/KickstartFile
#repo --name="CentOS"  --baseurl=cdrom:sr0 --cost=100

repo --name=a-base    --mirrorlist=http://mirrorlist.centos.org/?release=6&arch=x86_64&repo=os
repo --name=a-updates --mirrorlist=http://mirrorlist.centos.org/?release=6&arch=x86_64&repo=updates
repo --name=a-extras  --mirrorlist=http://mirrorlist.centos.org/?release=6&arch=x86_64&repo=extras


repo --name=epel --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=epel-6&arch=x86_64
repo --name=updates --mirrorlist=http://mirrorlist.centos.org/?release=6&arch=x86_64&repo=updates

%packages --nobase
#@additional-devel
#@base
#@console-internet
#@core
#@debugging
#@development
#@directory-client
#@ftp-server
#@java-platform
#@legacy-x
#@mysql-client
#@network-file-system-client
#@php
#@performance
#@perl-runtime
#@postgresql-client
#@remote-desktop-clients
#@scalable-file-systems
#@server-platform
#@server-policy
#@system-admin-tools
#@turbogears
#@web-server
#@web-servlet
#@x11
#libXinerama-devel
#openmotif-devel
#libXmu-devel
#xorg-x11-proto-devel
#startup-notification-devel
#libgnomeui-devel
#libbonobo-devel
#libXau-devel
#libgcrypt-devel
#popt-devel
#libdrm-devel
#libXrandr-devel
#libxslt-devel
#libglade2-devel
#gnutls-devel
#mtools
#pax
#oddjob
#wodim
#sgpio
#genisoimage
#device-mapper-persistent-data
#systemtap-client
#abrt-gui
#qt-mysql
#desktop-file-utils
#jpackage-utils
#samba-winbind
#certmonger
#pam_krb5
#krb5-workstation
#openmotif
#xterm
#xorg-x11-xdm
#libXmu
#libXp
#perl-DBD-MySQL
#perl-DBD-SQLite
#rdesktop
#crypto-utils
#certmonger
#perl-CGI
#epel-release
#openssh-clients


	@core


	# For the virtualbox additions
	kernel-devel
	kernel-headers  
	make 
	dkms
	bzip2
	openssh-clients
	nano
	htop

	# required to build ruby
	# should be kept for gems that build native extensions.
	wget
	automake
	gcc
	cpp
	glibc-devel
	glibc-headers
	glibc-kernheaders
	glibc
	glibc-common
	libgcc

	# required to build ruby bindings, can be removed after
	zlib-devel
	openssl-devel
	readline-devel
%end

%post

	# Change to a vt to see progress

	exec < /dev/tty3 > /dev/tty3
	chvt 3

	# redirect output to ks-post.log including stdout and stderr
#	(
		#######################################################
		# Turn off un-needed services
		#######################################################
		chkconfig sendmail off
		chkconfig vbox-add-x11 off
		chkconfig smartd off
		chkconfig ntpd off
		chkconfig cupsd off
		
		#######################################################
		# Setup for Vagrant
		#######################################################

		/usr/sbin/groupadd vagrant
/usr/sbin/useradd vagrant -g vagrant -G wheel
echo "vagrant"|passwd --stdin vagrant
cat > /etc/sudoers.d/vagrant << EOM
Defaults:vagrant !requiretty
vagrant        ALL=(ALL)       NOPASSWD: ALL
EOM
chmod 0440 /etc/sudoers.d/vagrant
echo "UseDNS no" >> /etc/ssh/sshd_config
		#groupadd vagrant
		#useradd vagrant -g vagrant -G wheel
		#echo 'Defaults env_keep="SSH_AUTH_SOCK"' >> /etc/sudoers
		#echo '%vagrant    ALL=NOPASSWD: ALL' >> /etc/sudoers

		# Add vagrant insecure private key for key auth
		# Make your own if this is private.
		# See http://vagrantup.com/docs/base_boxes.html
		mkdir /home/vagrant/.ssh
		echo "ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key" > /home/vagrant/.ssh/authorized_keys

		########################################################
		# Cleanup for compression
		#######################################################
		# Remove ruby build libs
		yum -y remove zlib-devel openssl-devel readline-devel
		
		# Cleanup other files we do not need
		yum -y groupremove "Dialup Networking Support" Editors "Printing Support" "Additional Development" "E-mail server"

		#######################################################
		# The system can now be packaged with 
		# `vagrant package VMNAME`
		#######################################################
		echo 'You can now package this box with `vagrant package VMNAME`'

#	yum install phpMyAdmin 
#	) 2>&1 | /usr/bin/tee /root/ks-post.log

	# switch back to gui
	chvt 7

%end

reboot